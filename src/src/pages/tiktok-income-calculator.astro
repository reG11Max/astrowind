---
import Layout from '~/layouts/PageLayout.astro';

const metadata = {
  title: 'TikTok Earnings Calculator — Estimate earnings from views & RPM',
  ignoreTitleTemplate: true,
};
---

<Layout metadata={metadata}>
  <section class="mx-auto max-w-5xl px-4 py-10 sm:py-14">
    <div class="text-center">
      <h1 class="text-3xl font-bold tracking-tight sm:text-5xl">
        TikTok Earnings Calculator
      </h1>
      <p class="mt-4 text-base text-gray-600 dark:text-gray-300">
        Estimate earnings from views using RPM. Use ranges to reflect real-world variability.
      </p>
    </div>

    <div class="mt-10 grid gap-6 lg:grid-cols-5">
      <!-- Card -->
      <div class="lg:col-span-3 rounded-2xl border border-gray-200 bg-white p-6 shadow-sm dark:border-gray-800 dark:bg-gray-900">
        <form id="ttCalc" class="space-y-5">
          <div>
            <label for="views" class="block text-sm font-medium text-gray-800 dark:text-gray-100">
              Monthly views
            </label>
            <input
              id="views"
              name="views"
              type="number"
              inputmode="numeric"
              min="0"
              placeholder="e.g. 1000000"
              class="mt-2 w-full rounded-xl border border-gray-300 bg-white px-4 py-3 text-gray-900 shadow-sm outline-none focus:border-gray-500 dark:border-gray-700 dark:bg-gray-950 dark:text-gray-100"
              required
            />
            <p class="mt-2 text-xs text-gray-500 dark:text-gray-400">
              Total views per month across your TikTok videos.
            </p>
          </div>

          <div class="grid gap-4 sm:grid-cols-2">
            <div>
              <label for="rpmLow" class="block text-sm font-medium text-gray-800 dark:text-gray-100">
                RPM (low), $
              </label>
              <input
                id="rpmLow"
                name="rpmLow"
                type="number"
                step="0.01"
                min="0"
                value="0.10"
                class="mt-2 w-full rounded-xl border border-gray-300 bg-white px-4 py-3 text-gray-900 shadow-sm outline-none focus:border-gray-500 dark:border-gray-700 dark:bg-gray-950 dark:text-gray-100"
                required
              />
              <p class="mt-2 text-xs text-gray-500 dark:text-gray-400">
                Conservative estimate (per 1000 views).
              </p>
            </div>

            <div>
              <label for="rpmHigh" class="block text-sm font-medium text-gray-800 dark:text-gray-100">
                RPM (high), $
              </label>
              <input
                id="rpmHigh"
                name="rpmHigh"
                type="number"
                step="0.01"
                min="0"
                value="1.00"
                class="mt-2 w-full rounded-xl border border-gray-300 bg-white px-4 py-3 text-gray-900 shadow-sm outline-none focus:border-gray-500 dark:border-gray-700 dark:bg-gray-950 dark:text-gray-100"
                required
              />
              <p class="mt-2 text-xs text-gray-500 dark:text-gray-400">
                Optimistic estimate (per 1000 views).
              </p>
            </div>
          </div>

          <div class="rounded-2xl border border-gray-200 bg-gray-50 p-4 text-sm text-gray-700 dark:border-gray-800 dark:bg-gray-950 dark:text-gray-300">
            <p class="font-medium text-gray-900 dark:text-gray-100">What this includes</p>
            <ul class="mt-2 list-disc space-y-1 pl-5">
              <li>Ad revenue / creator program style payouts (varies by region & eligibility)</li>
              <li>Does <span class="font-semibold">not</span> include brand deals, affiliate links, or product sales</li>
            </ul>
          </div>

          <button
            type="submit"
            class="w-full rounded-xl bg-gray-900 px-4 py-3 text-sm font-semibold text-white shadow-sm hover:opacity-90 dark:bg-white dark:text-gray-900"
          >
            Calculate
          </button>
        </form>

        <div id="ttResult" class="mt-6 hidden rounded-2xl border border-gray-200 bg-gray-50 p-5 dark:border-gray-800 dark:bg-gray-950">
          <div class="flex flex-col gap-2 sm:flex-row sm:items-baseline sm:justify-between">
            <h2 class="text-base font-semibold text-gray-900 dark:text-gray-100">Estimated monthly earnings</h2>
            <p class="text-xs text-gray-500 dark:text-gray-400">based on RPM range</p>
          </div>

          <div class="mt-4 grid gap-3 sm:grid-cols-3">
            <div class="rounded-xl bg-white p-4 dark:bg-gray-900">
              <p class="text-xs text-gray-500 dark:text-gray-400">Low</p>
              <p id="lowOut" class="mt-1 text-xl font-bold text-gray-900 dark:text-gray-100">$0</p>
            </div>
            <div class="rounded-xl bg-white p-4 dark:bg-gray-900">
              <p class="text-xs text-gray-500 dark:text-gray-400">Mid</p>
              <p id="midOut" class="mt-1 text-xl font-bold text-gray-900 dark:text-gray-100">$0</p>
            </div>
            <div class="rounded-xl bg-white p-4 dark:bg-gray-900">
              <p class="text-xs text-gray-500 dark:text-gray-400">High</p>
              <p id="highOut" class="mt-1 text-xl font-bold text-gray-900 dark:text-gray-100">$0</p>
            </div>
          </div>

          <p class="mt-4 text-sm text-gray-600 dark:text-gray-300">
            TikTok payouts vary widely by country, program eligibility, watch time, and monetization format.
            Many creators earn more from brand deals & affiliate links than from platform payouts.
          </p>
        </div>

        <script>
          function fmtMoney(n) {
            try {
              return new Intl.NumberFormat(undefined, { style: 'currency', currency: 'USD', maximumFractionDigits: 0 }).format(n);
            } catch {
              return '$' + Math.round(n).toString();
            }
          }

          const form = document.getElementById('ttCalc');
          const resultBox = document.getElementById('ttResult');
          const lowOut = document.getElementById('lowOut');
          const midOut = document.getElementById('midOut');
          const highOut = document.getElementById('highOut');

          form?.addEventListener('submit', (e) => {
            e.preventDefault();
            const views = Number((document.getElementById('views')).value || 0);
            const rpmLow = Number((document.getElementById('rpmLow')).value || 0);
            const rpmHigh = Number((document.getElementById('rpmHigh')).value || 0);

            // swap if reversed
            const lowRPM = Math.min(rpmLow, rpmHigh);
            const highRPM = Math.max(rpmLow, rpmHigh);

            const low = (views / 1000) * lowRPM;
            const high = (views / 1000) * highRPM;
            const mid = (low + high) / 2;

            lowOut.textContent = fmtMoney(low);
            midOut.textContent = fmtMoney(mid);
            highOut.textContent = fmtMoney(high);

            resultBox.classList.remove('hidden');
            resultBox.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
          });
        </script>
      </div>

      <!-- Sidebar -->
      <aside class="lg:col-span-2 space-y-6">
        <div class="rounded-2xl border border-gray-200 bg-white p-6 shadow-sm dark:border-gray-800 dark:bg-gray-900">
          <h3 class="text-sm font-semibold text-gray-900 dark:text-gray-100">Typical RPM ranges (rough)</h3>
          <ul class="mt-4 space-y-3 text-sm text-gray-700 dark:text-gray-300">
            <li class="flex items-start justify-between gap-3">
              <span>Low / mixed regions</span><span class="font-medium">$0.05–$0.30</span>
            </li>
            <li class="flex items-start justify-between gap-3">
              <span>Average</span><span class="font-medium">$0.10–$1.00</span>
            </li>
            <li class="flex items-start justify-between gap-3">
              <span>High (strong regions)</span><span class="font-medium">$0.50–$2.50</span>
            </li>
          </ul>
          <p class="mt-4 text-xs text-gray-500 dark:text-gray-400">
            Use your own RPM if you know it. This calculator is for quick estimation.
          </p>
        </div>

        <div class="rounded-2xl border border-gray-200 bg-white p-6 shadow-sm dark:border-gray-800 dark:bg-gray-900">
          <h3 class="text-sm font-semibold text-gray-900 dark:text-gray-100">Pro tip</h3>
          <p class="mt-2 text-sm text-gray-600 dark:text-gray-300">
            Many TikTok creators monetize primarily via brand deals, affiliates, and product sales.
            Platform payouts are often the smallest part.
          </p>
        </div>
      </aside>
    </div>
  </section>
</Layout>
